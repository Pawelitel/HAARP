$($("tr.caption th")[0]).append('<div id="loading-ajax"><img src="http://i38.fastpic.ru/big/2012/0524/96/5b354dc65439874a52f17728e730ac96.gif"/></div>');load(window,'http://pawelitel.github.com/HAARP/media/js/db/localStorageDB.js');$.ajax({url:"http://www.hockeyarena.net/ru/index.php?p=manager_training_form1.php",success:function(a){var b=$(a).find("table tbody tr");console.log("Найдено "+(b.length-4)+" игроков");if(b.length<22+4){console.error("Ошибка, найдено меньше 22-х игроков");return 0}var c={"Вратарь":"1","Пас":"2","Защита":"3","Скорость":"4","Самообладание":"5","Сила":"6","Бросок":"7","Нападение":"8"};var d={"C":"1","LW":"2","RW":"3","RD":"4","LD":"5","G1":"6","G2":"7","запас":"8"};var e=[],eneArray=[],formArray=[],traArray=[],scheduleArray=[],posArray=[];for(var i=0;i<b.length;i++){if($(b[i]).attr("class")!="caption")if($(b[i]).attr("class")!="thead"){var f=$(b[i]).find("td");var g=getUrlVars($(f[0]).find("a")[0].href)["id"].replace('#','');e.push(g);var h=$(f[10]).text();eneArray.push(h);var j=$(f[11]).text();formArray.push(j);var k=$(f[13]).text();traArray.push(k);var l=$(f[14].innerHTML).find("option[selected]").text();scheduleArray.push(c[l]);if(f[15]!=undefined)var m=f[15].innerHTML;else var m="запас";posArray.push(d[m])}}for(var i=0;i<e.length;i++){console.log("player "+e[i]+" tra "+traArray[i]+" schedule "+scheduleArray[i]+" pos "+posArray[i])}localStorageDB.saveAllValues("training",e,traArray)}});$("#loading-ajax").each(function(){$(this).remove()});{var imgs=$("img");for(var i=0;i<imgs.length;i++){var s=$("img").eq(i).attr("src");if(s.indexOf("nat")>0){var n=s.split("nat")[1].split(".")[0]|0;$("img").eq(i).replaceWith('<a href="http://www.hockeyarena.net/ru/index.php?p=public_national_team_info_basic.php&team_id='+n+'"><img src="'+s+'"></a>')}}}